<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  </head>

  <body>

    <div class="container">
      <h1>Find the Best Destinations</h1>
  
      <form id="destination-form">
        <div class="form-group">
          <label for="lat-input">Latitude</label>
          <input type="text" class="form-control" id="lat-input" name="lat_origin">
        </div>
        <div class="form-group">
          <label for="lon-input">Longitude</label>
          <input type="text" class="form-control" id="lon-input" name="lon_origin">
        </div>
        <div class="form-group">
          <label for="time-input">Time Budget (in hours)</label>
          <input type="text" class="form-control" id="time-input" name="timeBudgetInHour">
        </div>
        <div class="form-group">
          <label for="date-input">Date</label>
          <input type="date" class="form-control" id="date-input" name="date">
        </div>
        <button type="submit" class="btn btn-primary">Find Destinations</button>
      </form>
  
      <div id="destination-cards"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    
    <script>
      const destinationForm = document.getElementById('destination-form');
      const destinationCards = document.getElementById('destination-cards');
  
      destinationForm.addEventListener('submit', (event) => {
        event.preventDefault();
        const formData = new FormData(destinationForm);
        const lat = formData.get('lat_origin');
        const lon = formData.get('lon_origin');
        const timeBudgetInHour = formData.get('timeBudgetInHour');
        const date = formData.get('date');
  
        const url = `http://localhost/best_destinations_service/api/destinations/best?lat_origin=${lat}&lon_origin=${lon}&timeBudgetInHour=${timeBudgetInHour}&date=${date}`;
  
        fetch(url)
          .then(response => response.json())
          .then(data => {
            destinationCards.innerHTML = '';
            
            //check if status field is error
            if(data.status == 'error'){
              const card = document.createElement('div');
              card.classList.add('card');
              card.classList.add('mb-3');
  
              const cardBody = document.createElement('div');
              cardBody.classList.add('card-body');
  
              const cardTitle = document.createElement('h5');
              cardTitle.classList.add('card-title');
              cardTitle.innerText = data.message;
  
              cardBody.appendChild(cardTitle);
              card.appendChild(cardBody);
              destinationCards.appendChild(card);
            } 
            else if(data.status == "fail") {
              const card = document.createElement('div');
              card.classList.add('card');
              card.classList.add('mb-3');
  
              const cardBody = document.createElement('div');
              cardBody.classList.add('card-body');
  
              const cardTitle = document.createElement('h5');
              cardTitle.classList.add('card-title');
              cardTitle.innerText = data.data;
  
              cardBody.appendChild(cardTitle);
              card.appendChild(cardBody);
              destinationCards.appendChild(card);

            }
            else{
              destinations = data.data.destinations;
              destinations.forEach(destination => {
                const card = document.createElement('div');
                card.classList.add('card');
                card.classList.add('mb-3');
    
                const cardBody = document.createElement('div');
                cardBody.classList.add('card-body');
    
                const cardTitle = document.createElement('h5');
                cardTitle.classList.add('card-title');
                cardTitle.innerText = destination.name;
    
                const cardText = document.createElement('p');
                cardText.classList.add('card-text');
                cardText.innerText = destination.description;
    
                cardBody.appendChild(cardTitle);
                cardBody.appendChild(cardText);
                card.appendChild(cardBody);
                destinationCards.appendChild(card);
              });
            }

          })
          .catch(error => {
            
            console.error(error);        
          });
      });
    </script>
  </body>
</html>
